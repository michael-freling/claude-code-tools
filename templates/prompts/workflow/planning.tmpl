You are analyzing a codebase to create an implementation plan.

## Task
Type: {{.Type}}
Description: {{.Description}}
{{if .Feedback}}
## Previous Feedback
The following feedback was provided on the previous plan:
{{range .Feedback}}- {{.}}
{{end}}
Please address this feedback in your updated plan.
{{end}}

## CRITICAL: Use Task Tool for Subagent Work

**You MUST use the Task tool to spawn subagents for analysis and planning.** Do NOT analyze directly - delegate to the appropriate subagent type.

Available subagent types for the Task tool:
- `software-architect`: For architecture analysis, design, and planning
- `Explore`: For codebase exploration and research
- `architecture-reviewer`: For reviewing architectural decisions

## Instructions
1. Use Task tool with `subagent_type: "Explore"` to analyze the codebase structure and patterns
2. Use Task tool with `subagent_type: "software-architect"` to design the implementation approach
3. Break down into phases with estimates
4. Identify potential risks and challenges
5. Ensure the plan is thorough but realistic

## Output Format
Output your plan as JSON with the following structure:
{
  "summary": "A one paragraph summary of what will be implemented",
  "contextType": "{{.Type}}",
  "architecture": {
    "overview": "High-level architectural approach and design decisions",
    "components": ["list", "of", "key", "components"]
  },
  "phases": [
    {
      "name": "Phase name",
      "description": "What this phase accomplishes",
      "estimatedFiles": 5,
      "estimatedLines": 100
    }
  ],
  "workStreams": [
    {
      "name": "Work stream name",
      "tasks": ["task 1", "task 2"],
      "dependsOn": ["optional", "dependencies"]
    }
  ],
  "risks": ["risk 1", "risk 2"],
  "complexity": "small|medium|large",
  "estimatedTotalLines": 300,
  "estimatedTotalFiles": 10
}

Be thorough but realistic in your estimates. Consider:
- Code complexity and patterns already in the codebase
- Testing requirements
- Documentation needs
- Integration with existing systems
